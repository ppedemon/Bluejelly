module ResolveTest

extern bluejelly.Int.add{2}

fun id x = x

fun x = let x = x in x

fun g x = let! x$ = x in match x$ with 1 -> 2 | 2 -> 3 | z -> z

fun f n = 
  let rec x = g y
      and y = f z
      and z = id x
  in g z

fun add x y = 
  let! x$ = x in
  let! y$ = y in
  bluejelly.Int.add x$ y$

data Nil{0,0}
data Cons{1,2}

data False{0,0}
data True {1,0}

fun nested x = 
  let! y =
    let! z = bluejelly.Int.add 3 x in
    match z with
      | Nil -> Nil
      | Cons x y -> let s = bluejelly.Int.add x 1 in Cons s y
  in match y with
    | Nil -> 0
    | Cons z y -> 1
 
 fun filter p xs = 
   let! xs$ = xs in
   match xs$ with
     | Nil -> Nil
     | Cons x xs -> 
       let! y = p x in
       match y with
         | False -> filter p xs
         | True -> Cons x (@filter p xs)

fun nil = Nil
